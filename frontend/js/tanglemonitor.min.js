var $jscomp={scope:{},findInternal:function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,h=0;h<e;h++){var m=a[h];if(b.call(d,m,h,a))return{i:h,v:m}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var h=a[e];h in d||(d[h]={});d=d[h]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var h=d++;return{value:b(h,a[h]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return[a,d]})}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).i}},"es6-impl","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6-impl","es3");
var host=window.location.hostname,hostProtocol=window.location.protocol,db=new loki("txHistory"),txHistory,c=document.getElementById("canvas"),ctx=c.getContext("2d"),tooltip=document.getElementById("tooltip"),offsetWidth=200,offsetHeight=75,cWidth=c.width-offsetWidth,margin=110,pxSize=10,txPerLine=Math.ceil(cWidth/pxSize),tickRate=1E3,textColor="#000000",strokeColorNorm="#cccccc",strokeColorSelect="#ff0000",fontFace="Consolas",fontSizeHeader="13px",fontSizeAxis="11px",txAmountToPoll=15E3,maxTransactions=
15E3,websocketActive=!1,coordinator="EQSAUZXULTTYZCLNJNTXQTQHOMOFZERHTCG",pxColorUnconf={r:0,g:0,b:0,a:1},pxColorConf={r:0,g:255,b:0,a:1},pxColorReattach={r:255,g:255,b:0,a:1},pxColorMilestone={r:0,g:0,b:255,a:1},txList=[],filterForValueTX=!1,filterForSpecificAddresses=[],filterAddress="",manualPoll=!1,endlessMode=!1,selectedAddress="",selectedAddressBuffer="",totalConfRate=0,totalConfRateEff=0,totalConfirmations=[],milestoneMetrics=[],milestoneIntervalList=[],milestoneInterval=0,totalConfirmationTime=
0,totalTransactions=0,totalTPS=0,totalCTPS=0,totalTPSeff=0,totalCTPSeff=0,effectiveConfRateIndex=0,topList=[],toplistAdditional=0,topListCount=15,toplistSortIndex=[2,"desc"],toplistMinTX=1,InitialHistoryPollRetries=10,mousePos,pixelMap=[],timer=[],rateLimiter=0,txOfMousePosition={},ChangeAddress=function(){selectedAddress=document.getElementById("address_input").value.substring(0,81);selectedAddressBuffer=document.getElementById("address_input").value.substring(0,81)};
document.getElementById("address_button").onclick=function(){ChangeAddress();drawGraph({loop:!1})};
var getRndInteger=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},getRowPosition=function(a){a=a.getBoundingClientRect();return{left:a.left+window.scrollX,top:a.top+window.scrollY}},createTable=function(a){a=_.orderBy(a,function(a){return a[toplistSortIndex[0]][0]},[toplistSortIndex[1]]);var b=a.length,d=document.getElementById("toplist");d.innerHTML="";var e=document.createElement("thead"),h=document.createElement("tbody"),m=document.createElement("tr"),p=document.getElementById("hideSpecificAddressCheckboxWrapper");
p.classList.add("hide");if(0<a.length){for(var g={},f=0;f<b;g={current_row:g.current_row},f++){g.current_row=document.createElement("tr");g.current_row.addEventListener("mouseenter",function(a){return function(){filterAddress=a.current_row.getAttribute("tx");var b=getRowPosition(a.current_row);p.style.top=b.top+1+"px";p.style.left=b.left-20+"px";p.classList.remove("hide")}}(g),!1);for(var k={},n=0;n<a[0].length;k={current_cell:k.current_cell},n++){k.current_cell=document.createElement("td");k.current_cell.addEventListener("click",
function(a){return function(){selectedAddress=a.current_cell.getAttribute("tx");selectedAddressBuffer=a.current_cell.getAttribute("tx");document.getElementById("address_input").value=a.current_cell.getAttribute("tx");drawGraph({loop:!1})}}(k),!1);var l=void 0;switch(n){case 0:l=""+(f+1);break;case 1:l=(a[f][1].substring(0,35)===coordinator?"[COO]"+coordinator.substring(0,30):a[f][1].substring(0,35))+"...";break;case 2:l=a[f][2]+" ["+Math.round(parseInt(a[f][2])/maxTransactions*100)+"%]";break;case 3:l=
a[f][3][0]+" ["+(100>a[f][3][1]?a[f][3][1].toFixed(1):a[f][3][1].toFixed(0))+"%]";break;case 4:l=a[f][4][0]+" ["+(100>a[f][4][1]?a[f][4][1].toFixed(1):a[f][4][1].toFixed(0))+"%]";break;case 5:l=""+(Infinity===a[f][5][0]?"inf.":a[f][5][0].toFixed(2));break;case 6:l=""+(Infinity===a[f][6][0]?"inf.":0<a[f][6][0]?"+":"")+(Infinity>a[f][6][0]?a[f][6][0].toFixed(0)+"%":"");break;case 7:l=""+a[f][7][0].toFixed(2);break;case 8:l=""+a[f][8][0].toFixed(2);break;case 9:l=a[f][9][0]?a[f][9][0].toFixed(1)+" min":
"n/a";break;case 10:l=a[f][10][0]?""+(0<a[f][10][0]?"+":"")+a[f][10][0].toFixed(1)+"%":"n/a";break;default:l="N/A"}l=document.createTextNode(l);k.current_cell.appendChild(l);k.current_cell.setAttribute("tx",a[f][1]);g.current_row.setAttribute("tx",a[f][1]);0<=a[f][6][0]&&6==n?k.current_cell.setAttribute("style","color: #008000"):0>a[f][6][0]&&6==n?k.current_cell.setAttribute("style","color: #ff0000"):0<=a[f][10][0]&&10==n?k.current_cell.setAttribute("style","color: #ff0000"):0>a[f][10][0]&&10==n&&
k.current_cell.setAttribute("style","color: #008000");g.current_row.appendChild(k.current_cell)}h.appendChild(g.current_row)}for(b={i$0:0};b.i$0<a[0].length;b={i$0:b.i$0},b.i$0++){g=document.createElement("td");f=document.createElement("img");f.setAttribute("src","img/sort.png");f.classList.add("table_head_sortpic");k=void 0;switch(b.i$0){case 0:k="#";break;case 1:k="Address";break;case 2:k="Total";break;case 3:k="Confirmed";break;case 4:k="Unconfirmed";break;case 5:k="C.Ratio";break;case 6:k="\u00b1Avg.C.Ratio";
break;case 7:k="TPS";break;case 8:k="CTPS";break;case 9:k="~C.Time";break;case 10:k="\u00b1Avg.Time";break;default:k="N/A"}k=document.createTextNode(k);g.appendChild(k);0<b.i$0&&g.appendChild(f);m.appendChild(g);g.addEventListener("click",function(a){return function(){toplistSortIndex=a.i$0===toplistSortIndex[0]&&"desc"===toplistSortIndex[1]?[a.i$0,"asc"]:[a.i$0,"desc"];createTable(topList)}}(b),!1)}e.appendChild(m);d.appendChild(e);d.appendChild(h)}},GetMousePos=function(a,b){if(null==b.pageX&&null!=
b.clientX){var d=document.documentElement,e=document.body;b.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d.clientLeft||0);b.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d.clientTop||0)}d=a.getBoundingClientRect();return{x:b.clientX-d.left,y:b.clientY-d.top,xReal:b.pageX,yReal:b.pageY}},GetTXofMousePosition=function(a){a.y-=offsetHeight;a.x-=margin;return pixelMap.reduce(function(b,d){a.x>=d.x&&a.x<d.x+pxSize&&a.y>=d.y&&a.y<d.y+pxSize&&(b=d);return b},0)},OpenLink=function(a){a&&
window.open("https://thetangle.org/address/"+a);txOfMousePosition.hash&&window.open("https://thetangle.org/transaction/"+txOfMousePosition.hash)},lastTxMousoverBuffer="";
c.addEventListener("mousemove",function(a){var b=Date.now();mousePos=GetMousePos(c,a);txOfMousePosition=GetTXofMousePosition(mousePos);5<b-rateLimiter&&(txOfMousePosition.hash?(lastTxMousoverBuffer!==txOfMousePosition.hash&&(lastTxMousoverBuffer=txOfMousePosition.hash,drawGraph({loop:!1})),a=_.round((txOfMousePosition.ctime-txOfMousePosition.receivedAt)/1E3/60,2),a=txOfMousePosition.confirmed?a+" Minutes":txOfMousePosition.reattached?"Reattached transaction":"Not confirmed yet",tooltip.innerHTML=
"Address:\u00a0"+txOfMousePosition.address+"<br>\n                                TX Hash:\u00a0"+txOfMousePosition.hash+"<br>\n                                Bundle:\u00a0\u00a0"+txOfMousePosition.bundle+"<br>\n                                Tag:\u00a0\u00a0\u00a0\u00a0\u00a0"+txOfMousePosition.tag+"<br>\n                                C. Time:\u00a0"+a+"<br>\n                                Value:\u00a0\u00a0\u00a0"+(0!==txOfMousePosition.value?txOfMousePosition.value/1E6*100/100+" MIOTA":"Zero value transaction"),
selectedAddress=txOfMousePosition.address,tooltip.style.display="block",tooltip.style.top=mousePos.yReal+15+"px",tooltip.style.left=mousePos.xReal+15+"px",document.body.style.cursor="pointer"):(tooltip.style.display="none",document.body.style.cursor="auto",txOfMousePosition={},selectedAddress=""),rateLimiter=Date.now())},!1);
c.addEventListener("mouseout",function(){tooltip.style.display="none";document.body.style.cursor="auto";txOfMousePosition={};selectedAddress=selectedAddressBuffer;drawGraph({loop:!1})},!1);var netselector=document.getElementById("netselector"),netSwitch=function(){window.location.replace("https://"+("mainnet"===netselector.value?"www":netselector.value)+".tanglemonitor.com")};netselector.addEventListener("change",netSwitch);
document.getElementById("address_button_reset").addEventListener("click",function(){selectedAddressBuffer=selectedAddress="";document.getElementById("address_input").value="";drawGraph({loop:!1})},!1);var checkBoxZero=document.getElementById("hideZero");document.getElementById("hideZero").addEventListener("click",function(){filterForValueTX=!0===checkBoxZero.checked?!0:!1;drawGraph({loop:!1});CalcToplist(!1)},!1);
document.getElementById("hideSpecificAddressCheckboxWrapper").addEventListener("click",function(){filterForSpecificAddresses.push(filterAddress);drawGraph({loop:!1});CalcToplist(!1)},!1);var maxTransactionsBuffer=maxTransactions,checkBoxEndless=document.getElementById("endlessMode");
document.getElementById("endlessMode").addEventListener("click",function(){!0===checkBoxEndless.checked?(endlessMode=!0,maxTransactionsBuffer=maxTransactions,maxTransactions=1E13):(endlessMode=!1,maxTransactions=maxTransactionsBuffer)},!1);checkBoxZero.checked=!1;checkBoxEndless.checked=!1;c.addEventListener("click",function(){OpenLink(!1)},!1);document.getElementById("toplist-more").addEventListener("click",function(){toplistAdditional+=5;CalcToplist(!1)},!1);
document.getElementById("toplist-all").addEventListener("click",function(){toplistAdditional=1E4;CalcToplist(!1)},!1);document.getElementById("toplist-reset").addEventListener("click",function(){topListCount=15;toplistAdditional=0;CalcToplist(!1)},!1);document.getElementById("minNumberOfTxIncluded_button").addEventListener("click",function(){toplistMinTX=parseInt(document.getElementById("minNumberOfTxIncluded").value);CalcToplist(!1)},!1);
document.getElementById("txToPollWrapper_button").addEventListener("click",function(){txAmountToPoll=parseInt(document.getElementById("txToPoll").value);document.getElementById("loadingTX").classList.remove("hide");document.getElementById("loadingTX").classList.add("inline_block");manualPoll=!0;maxTransactions=txAmountToPoll;InitialHistoryPoll(!1)},!1);
var calcLineCount=function(a,b,d){return Math.floor(a*b/d)},UpdateTXStatus=function(a,b){var d=a.hash,e=a.milestone,h=a.ctime,m=txHistory.by("hash",d);if(m){if("txConfirmed"===b||"Milestone"===b)m.ctime=h,m.confirmed=!0;"Milestone"===b&&(m.milestone=e);"Reattach"===b&&(m.reattached=!0);txHistory.update(m)}else console.log("LokiJS: "+("Milestone"===b?"Milestone":"TX")+" not found in local DB - Hash: "+d+" | updateType: "+b)},drawGraph=function(a){for(ctx.clearRect(0,0,cWidth+offsetWidth,c.height);c.height<
timer.length*pxSize*2+offsetHeight+30;)c.height+=50;var b=[];txList=txHistory.chain().find({$and:[filterForValueTX?{value:{$ne:0}}:{},0<filterForSpecificAddresses.length?{address:{$nin:filterForSpecificAddresses}}:{}]}).simplesort("receivedAt").data();ctx.font=fontSizeHeader+" "+fontFace;ctx.fillStyle=textColor;ctx.textBaseline="hanging";ctx.textAlign="left";ctx.fillText("Total TX count        "+totalTransactions,margin+10,10);ctx.fillText("Avg. TPS              "+totalTPS,margin+10,25);ctx.fillText("Avg. conf.ratio       "+
totalConfRate+" %",margin+10,40);ctx.fillText("Avg. eff. conf.ratio  "+totalConfRateEff+" %",margin+10,55);ctx.fillText("Avg. conf. time   "+totalConfirmationTime+" min",margin+240,10);ctx.fillText("Avg. CTPS         "+totalCTPS,margin+240,25);ctx.fillText("Avg. MS interval  "+milestoneInterval+" min",margin+240,40);ctx.fillText("Unconfirmed",cWidth-60,10);ctx.fillText("Confirmed",cWidth-60,25);ctx.fillText("Reattached",cWidth+40,10);ctx.fillText("Milestone",cWidth+40,25);ctx.fillText("Avg.conf.time indicator",
cWidth-60+5,40);ctx.fillStyle="rgba(0,0,0,1)";ctx.fillRect(cWidth-75,10,pxSize,pxSize);ctx.fillStyle="rgba(0,255,0,1)";ctx.fillRect(cWidth-75,25,pxSize,pxSize);ctx.fillStyle="rgba(255,255,0,1)";ctx.fillRect(cWidth+25,10,pxSize,pxSize);ctx.fillStyle="rgba(0,0,255,1)";ctx.fillRect(cWidth+25,25,pxSize,pxSize);ctx.fillStyle="rgba(244,65,205,1)";ctx.fillRect(cWidth-75,45,15,3);var d=function(a,b){var d=0,e=2*txPerLine;if(0==b%e){var g=b/e;ctx.font=fontSizeAxis+" "+fontFace;ctx.fillStyle=textColor;ctx.textBaseline=
"hanging";ctx.textAlign="right";var f=txList.slice(g*e,g*e+e),e=f.length,f=f.filter(function(a){return!1!==a.confirmed}).length,e=Math.round(f/(f+(e-f))*100),g=Math.round(2*txPerLine/(timer[g+1]/1E3-timer[g]/1E3)*10)/10;ctx.fillText((isNaN(e)?"0":e)+"%"+(isNaN(g)?" [...]":" ["+g.toFixed(1)+" TPS]"),margin-5,a.y+offsetHeight+5)}g=pxColorUnconf;e=strokeColorNorm;if(!1===a.confirmed||void 0===a.confirmed)g=pxColorUnconf,e=strokeColorNorm,g.a=1;"f"===a.milestone&&!0===a.reattached&&(g=pxColorReattach,
e=strokeColorNorm,g.a=1);!0===a.confirmed&&"f"===a.milestone&&(g=pxColorConf,e=strokeColorNorm,g.a=1);"m"===a.milestone&&(ctx.fillStyle="rgba(255, 255, 255, 1)",ctx.fillRect(margin+cWidth+5,a.y+offsetHeight,100,pxSize),ctx.font=fontSizeAxis+" "+fontFace,ctx.fillStyle=textColor,ctx.textBaseline="hanging",ctx.textAlign="left",g=pxColorMilestone,e=strokeColorNorm,f=Math.floor((parseInt(Date.now())-a.receivedAt)/1E3/60),ctx.fillText(f+" min",margin+cWidth+5,a.y+offsetHeight),g.a=1);"t"===a.milestone&&
(g=pxColorMilestone,e=strokeColorNorm,g.a=1);a.address===selectedAddress&&(e=strokeColorSelect,d=1,g.a=1);b===effectiveConfRateIndex&&(ctx.fillStyle="rgba(244,65,205,1)",ctx.fillRect(margin+cWidth+5,a.y+offsetHeight-1,15,3));ctx.fillStyle="rgba("+g.r+","+g.g+","+g.b+","+g.a+")";ctx.fillRect(a.x+margin,a.y+offsetHeight,pxSize,pxSize);ctx.strokeStyle=e;ctx.lineWidth=1;ctx.strokeRect(a.x+margin,a.y+offsetHeight,pxSize-d,pxSize-d)};txList.map(function(a,h){var e=calcLineCount(h,pxSize,cWidth),e={x:h*
pxSize-e*pxSize*txPerLine,y:e*pxSize,hash:a.hash,bundle:a.bundle,address:a.address,value:a.value,tag:a.tag,confirmed:a.confirmed,reattached:a.reattached,receivedAt:a.receivedAt,ctime:a.ctime,milestone:a.milestone};b.push(e);d(e,h)});pixelMap=b;a.loop&&window.setTimeout(function(){return drawGraph({loop:!0})},tickRate)},CalcToplist=function(a){topListCount+=toplistAdditional;var b=0,d=0,e={},h=[];txList.map(function(a){var b=a.ctime-a.receivedAt;a.confirmed&&h.push(b);if(e[a.address]){var d=e[a.address].c,
g=e[a.address].u;e[a.address].t+=1;a.confirmed?(e[a.address].c=d+1,e[a.address].ct.push(b)):e[a.address].u=g+1}else e[a.address]={c:a.confirmed?1:0,u:a.confirmed?0:1,t:1,ct:a.confirmed?[b]:[]}});e=Object.entries(e);1<toplistMinTX&&(e=_.filter(e,function(a){return a[1].t>=toplistMinTX}));var e=_.orderBy(e,function(a){return a[1].t},[toplistSortIndex[1]]),e=e.slice(0,topListCount),m=[],p=_.mean(h)/1E3/60;e.map(function(a){var e=a[0],g=a[1].u,h=a[1].c;b+=h;d+=g;var l=a[1].t;a=_.mean(a[1].ct)/1E3/60;
var r=a/p*100-100,t=h/l*100,u=g/l*100,q=h/l,v=q/(b/(b+d))*100-100,w=Math.round(l/((Date.now()-txList[0].receivedAt)/1E3)*100)/100,x=Math.round(h/((Date.now()-txList[0].receivedAt)/1E3)*100)/100;m.push([[0],e,[l],[h,t],[g,u],[q],[v],[w],[x],[a],[r]])});topList=m;0<m.length&&createTable(m);a&&window.setTimeout(function(){return CalcToplist(!0)},3E4)},CalcMetricsSummary=function(){var a=Date.now();milestoneMetrics=[];milestoneIntervalList=[];totalTransactions=txList.length;if(totalTransactions>=maxTransactions){var b=
Math.floor(totalTransactions/maxTransactions);txHistory.chain().find(filterForValueTX?{value:{$ne:0}}:{}).limit(txPerLine*b).remove()}var d=[];txList.map(function(a,b){0===b%(2*txPerLine)&&d.push(a.receivedAt)});timer=d;var e=_.meanBy(totalConfirmations,function(a){if(!1===a.milestone)return a.ctime});totalConfirmationTime=_.round(e/1E3/60,1);totalConfirmations=txList.reduce(function(b,d){!0===d.confirmed&&(b.push({ctime:d.ctime-d.receivedAt,milestone:"f"===d.milestone?!1:!0,effective:d.receivedAt>
a-e?!1:!0}),"m"===d.milestone&&milestoneMetrics.push(d.receivedAt));return b},[]);b=_.countBy(totalConfirmations,"effective")["true"];milestoneMetrics.map(function(a,b){0<b&&milestoneIntervalList.push(a-milestoneMetrics[b-1])});milestoneInterval=Math.round(_.mean(milestoneIntervalList)/1E3/60*10)/10;var h=totalConfirmations.length;totalConfRate=Math.round(h/(h+(totalTransactions-h))*1E4)/100;effectiveConfRateIndex=_.findIndex(txList,function(b){return b.receivedAt>a-e});0<totalTransactions&&(totalTPS=
Math.round(totalTransactions/((a-txList[0].receivedAt)/1E3)*100)/100,totalCTPS=Math.round(h/((a-txList[0].receivedAt)/1E3)*100)/100,txList[effectiveConfRateIndex]&&txList[effectiveConfRateIndex].receivedAt&&(totalTPSeff=Math.round(effectiveConfRateIndex/((a-txList[effectiveConfRateIndex].receivedAt)/1E3)*100)/100,totalCTPSeff=Math.round(b/((a-txList[effectiveConfRateIndex].receivedAt)/1E3)*100)/100,totalConfRateEff=Math.round(totalCTPSeff/totalTPSeff*1E4)/100));20<totalTPS&&!endlessMode&&!manualPoll?
maxTransactions=3E4:20>=totalTPS&&!endlessMode&&!manualPoll&&(maxTransactions=15E3);window.setTimeout(function(){return CalcMetricsSummary()},1500)},InitialHistoryPoll=function(a){fetch(hostProtocol+"//"+host+":4433/api/v1/getRecentTransactions?amount="+txAmountToPoll,{cache:"no-cache"}).then(function(a){return a.json()}).then(function(b){document.getElementById("loading").style.display="none";document.getElementById("loadingTX").classList.add("hide");document.getElementById("loadingTX").classList.remove("inline_block");
txList=b.txHistory?b.txHistory:[];txHistory&&db.removeCollection("txHistory");txHistory=db.addCollection("txHistory",{unique:["hash"],indices:["address","bundle","receivedAt"]});txHistory.insert(txList);a&&(drawGraph({loop:!0}),CalcMetricsSummary(),CalcToplist(!0));a&&!websocketActive?InitWebSocket():websocketActive&&console.log("WebSocket already initialized")})["catch"](function(b){console.error("Error fetching txHistory",b);0<InitialHistoryPollRetries&&(window.setTimeout(function(){return InitialHistoryPoll(a)},
2500),InitialHistoryPollRetries--)})},InitWebSocket=function(){if(!websocketActive){websocketActive=!0;var a=io.connect(hostProtocol+"//"+host+":4434",{secure:"https:"===hostProtocol?!0:!1,reconnection:!1});a.on("connect",function(){console.log("Successfully connected to Websocket.. [websocketActive: "+websocketActive+"]");a.on("newTX",function(a){if(![!0].includes(!1)){txList.push(a);try{txHistory.insert(a)}catch(d){console.log(d)}}});a.on("update",function(a){UpdateTXStatus(a,"txConfirmed")});a.on("updateMilestone",
function(a){UpdateTXStatus(a,"Milestone")});a.on("updateReattach",function(a){UpdateTXStatus(a,"Reattach")});a.on("disconnect",function(b){console.log("WebSocket disconnect ["+b+"]");websocketActive=!1;a.close();window.setTimeout(function(){InitWebSocket();console.log("WebSocket reconnecting...")},getRndInteger(100,1E3))});a.on("reconnect",function(a){console.log("WebSocket reconnect ["+a+"]")});a.on("reconnect_error",function(a){console.log("WebSocket reconnect_error ["+a+"]");websocketActive=!1;
window.setTimeout(function(){InitWebSocket()},getRndInteger(10,100))});a.on("connect_timeout",function(a){console.log("WebSocket connect_timeout ["+a+"]");websocketActive=!1;window.setTimeout(function(){InitWebSocket()},getRndInteger(10,100))});a.on("error",function(a){console.log("WebSocket error ["+a+"]")});a.on("connect_error",function(a){console.log("WebSocket connect_error ["+a+"]");websocketActive=!1;window.setTimeout(function(){InitWebSocket()},getRndInteger(10,100))});window.addEventListener("beforeunload",
function(){a.close()})})}},Main=function(){InitialHistoryPoll(!0)};Main();
